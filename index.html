<!DOCTYPE html>
<html>
    <head>
        <title>INFO4310 HW4 - rcc263, jmw555</title>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <style>
            .gridlines{
                color: lightgrey;
            }

            .axis{
                color: black !important;
            }
        </style>
    </head>
    <body>
        <h1>The Best NBA Players, According to RAPTOR</h1>
        <h2>Ronin Chasan (rcc263), Jacob Wise (jmw555)</h2>

        <div style="display: flex; flex-direction: row;">
            <div id="filters-container">
                
            </div>
            <svg id="scatter" width="500" height="500" style="margin-left: 50px;"></svg>
            <div style="margin-left: 50px;">
                <h2>Top Five</h2>
                <ol>
                    <li id="first"></li>
                    <li id="second"></li>
                    <li id="third"></li>
                    <li id="fourth"></li>
                    <li id="fifth"></li>
                </ol>
            </div>
        </div>

        <script>
            const load = async function() {
                let data = await d3.csv("modern_raptor.csv");
                let colorData = await d3.csv("nba-team-colors.csv");
                data = data.filter((d) => { return (d["season"]==="2021") });
                data = data.filter((d) => { return (Number(d["mp"])>=1000) });

                let topFive = data.sort((a, b) => b["raptor_total"] - a["raptor_total"]).slice(0, 5);
                console.log(topFive)

                console.log(data);

                var dataTeams = []
                data.map(function(d) {
                    if (!dataTeams.includes(d.team)){
                        dataTeams.push(d.team);
                    }
                })

                console.log(dataTeams)

                var teams = []
                var color1 = []
                var color2 = [];
                colorData.map(function(d) {
                    teams.push(d.Team);
                    color1.push(d.Color1);
                    color2.push(d.Color2);
                })

                var primaryColors = d3.scaleOrdinal()
                    .domain(teams)
                    .range(color1);

                var secondaryColors = d3.scaleOrdinal()
                    .domain(teams)
                    .range(color2);

                console.log(primaryColors("NYK"))
                const offExtent = d3.extent(data, d => d['raptor_offense']);
                const defExtent = d3.extent(data, d => d['raptor_defense']);
                const totalExtent = d3.extent(data, d => d['raptor_total'])

                const scatterplot = d3.select("#scatter");
                const scatterWidth = scatterplot.attr("width");
                const scatterHeight = scatterplot.attr("height");
                const scatterMargin = { top: 30, right: 30, bottom: 30, left: 30};
                const scatterAreaWidth = scatterWidth - scatterMargin.left - scatterMargin.right;
                const scatterAreaHeight = scatterHeight - scatterMargin.top - scatterMargin.bottom;

                scatterplot.append("rect")
                    .attr("fill", "lightblue")
                    .attr("x", scatterAreaWidth/2)
                    .attr("y", 0)
                    .attr("height", scatterAreaHeight/2)
                    .attr("width", scatterAreaWidth/2)
                    .attr("transform","translate("+scatterMargin.left+","+scatterMargin.top+")")
                    .attr("opacity", 0.7)
                scatterplot.append("rect")
                    .attr("fill", "pink")
                    .attr("x", 0)
                    .attr("y", scatterAreaHeight/2)
                    .attr("height", scatterAreaHeight/2 + 10)
                    .attr("width", scatterAreaWidth/2 + 10)
                    .attr("transform","translate("+(scatterMargin.left-10)+","+scatterMargin.top+")")
                    .attr("opacity", 0.7)

                let annotations = scatterplot.append("g").attr("id","annotations");
                const scatter = scatterplot.append("g")
                                // .attr("transform","translate("+scatterMargin.left+","+scatterMargin.top+")");
                

                const offScale = d3.scaleLinear().domain([-10, 10]).range([0, scatterAreaWidth]);
                const defScale = d3.scaleLinear().domain([10, -10]).range([0, scatterAreaHeight]);

                let leftAxis = d3.axisLeft(defScale)
                //    .tickFormat(d3.format("$.0s"));
                let leftGridlines = d3.axisLeft(defScale)
                                        .tickSize(-scatterAreaWidth-10)
                                        .tickFormat("")
                let bottomAxis = d3.axisBottom(offScale)
                                    // .tickFormat(d3.format("~f"));
                let bottomGridlines = d3.axisBottom(offScale)
                                        .tickSize(-scatterAreaHeight-10)
                                        .tickFormat("")
                
                annotations.append("g")
                    .attr("class", "y gridlines")
                    .attr("transform",`translate(${scatterMargin.left-10},${scatterMargin.top})`)
                    .call(leftGridlines);

                annotations.append("g")
                    .attr("class", "y axis")
                    .attr("transform",`translate(${scatterMargin.left-10},${scatterMargin.top})`)
                    .call(leftAxis)

                annotations.append("g")
                    .attr("class", "x gridlines")
                    .attr("transform",`translate(${scatterMargin.left},${scatterAreaHeight+scatterMargin.top+10})`)
                    .call(bottomGridlines);
                annotations.append("g")
                    .attr("class", "x axis")
                    .attr("transform",`translate(${scatterMargin.left},${scatterAreaHeight+scatterMargin.top+10})`)
                    .call(bottomAxis);

                //zero lines
                annotations.append("path")
                    .attr("d", `M${scatterMargin.left-10},${scatterMargin.top+(scatterAreaHeight/2)} h ${scatterAreaWidth+10}`)
                    .attr("stroke", "grey")
                        
                annotations.append("path")
                    .attr("d", `M${scatterMargin.left+(scatterAreaWidth/2)},${scatterMargin.top} v ${scatterAreaWidth+10} `)
                    .attr("stroke", "grey")

                
                function plotCircles() {
                    let circles = scatter.selectAll("circle.player")
                            .data(data)
                            .join('circle').attr("class", "player")
                            .attr("cx", d => offScale(d["raptor_offense"]))
                            .attr("cy", d => defScale(d["raptor_defense"]))
                            // .attr("r", 3.5)
                            .attr("r", function(d) {
                                if (topFive.includes(d)) {return 10}
                                else 	{ return 3.5 }
                            ;})
                            .attr("stroke", d=> secondaryColors(d['team']))
                            .attr("stroke-width", "1.5px")
                            .attr("fill", d=> primaryColors(d['team']))
                            .style("opacity", .8)
                            .attr("transform","translate("+scatterMargin.left+","+scatterMargin.top+")")
                }
                plotCircles();

                d3.select("li#first").text(topFive[0]["player_name"])
                d3.select("li#second").text(topFive[1]["player_name"])
                d3.select("li#third").text(topFive[2]["player_name"])
                d3.select("li#fourth").text(topFive[3]["player_name"])
                d3.select("li#fifth").text(topFive[4]["player_name"])

                function raptorType() {
                    let values = ['raptor_total', 'raptor_offense', 'raptor_defense'];

                    var label = d3.select("div#filters-container").append("text").text("RAPTOR Type");
                    var select = d3.select("div#filters-container")
                                        .append("div")
                                        .append("select")
                                        .attr("class", "dropdownFilter")
                                        .attr("id", "raptorType")
                                        // .attr("data-field", field)
                                        .style("border", "1px solid black")
                                        .style("border-radius", "5px")
                                        .style("margin-top", "6px")
                                        .style("margin-bottom", "12px")
                                        .on("change", function(e, d) {
                                            filterRaptorType(d3.select(this).node().value);
                                            // filter(d3.select(this).attr("data-field"), d3.select(this).node().value);
                                        })
                    select.selectAll("raptorType")
                            .data(values)
                            .enter()
                                .append("option")
                                .attr("value", function (d) { return d; })
                                .text(function (d) { return d.charAt(0).toUpperCase() + d.substring(1,6) + " " + d.charAt(7).toUpperCase() + d.substring(8); });

                }
                raptorType();

                function filterRaptorType(val) {
                    topFive = data.sort((a, b) => b[val] - a[val]).slice(0, 5);
                    d3.select("li#first").text(topFive[0]["player_name"])
                    d3.select("li#second").text(topFive[1]["player_name"])
                    d3.select("li#third").text(topFive[2]["player_name"])
                    d3.select("li#fourth").text(topFive[3]["player_name"])
                    d3.select("li#fifth").text(topFive[4]["player_name"])
                    plotCircles();
                }
            
        }
            load();
        </script>
    </body>
</html>