<!DOCTYPE html>
<html>
    <head>
        <title>INFO4310 HW4 - rcc263, jmw555</title>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <style>
            * {
                font-family: 'Tahoma', Arial, sans-serif;
            }

            body{
                background: #ffefd5;
            }

            .gridlines{
                color: lightgrey;
            }

            .axis{
                color: black !important;
            }

            #name{
                margin: 0 0 5px;
            }
            #teamname{
                margin: 0 0 8px;
                border-radius: 5px;
                padding: 4px;
                text-align: center;
            }

            input, select, button {
                border-radius: 6px;
                border: 1px solid grey;
                height: 24px;
                padding: 2px 2px 2px 6px;
            }

            select{
                cursor: pointer;
            }

            button {
                padding: 6px !important;
                height: auto !important;
                cursor: pointer;
                transition:all 0.3s;
            }

            button:hover{
                background-color: white;
            }

            #click-for-more{
                /* background-color: white; */
                width: 198px;
                height: 200px;
                text-align: center;
                color: grey;
                font-style: italic;
                display: flex;
                justify-content: center;
                align-items: center;
                /* border-top-right-radius: 8px;
                border-bottom-right-radius: 8px; */
                transition: all 0.65s;
                margin-bottom: -200px;
            }


            #filters-container {
                width: 200px;
                margin-top: 50px;
            }


        </style>
    </head>
    <body>
        <h1 style="text-align: center;">The Best NBA Players, According to RAPTOR</h1>
        <h2 style="text-align: center;">Ronin Chasan (rcc263), Jacob Wise (jmw555)</h2>
        <p style="width: 75%; margin: auto; text-align: center;">RAPTOR is a statistical plus-minus method developed by FiveThirtyEight in 2019. 
            Built as a tool for the modern NBA, RAPTOR aims to reflect how players are evaluated by front offices. 
            RAPTOR measures the number of points a player contributes to team offense and team defense per 100 possessions, relative to a league-average player. 
            For example, a player with an Offensive RAPTOR of +1.5 means he improves his team's offense by 1.5 points per 100 offensive possessions while he is on the floor. 
            Defensive RAPTOR works similarly for defense, while Total RAPTOR is a combination of the two.</p>

        <div style="display: flex; flex-direction: row; justify-content: center;">
            <div id="filters-container">
                
            </div>
            <svg id="scatter" width="550" height="550" style="margin-left: 40px;"></svg>
            <div style="margin-left: 30px; display: flex; flex-direction: column; width: 300px;">
                <div>
                    <div id="top-five-title-container" style="display: flex; align-items: center;">
                        <h2 style="margin-right: 8px;">Top Five</h2>
                    </div>
                    <ol>
                        <li id="first"></li>
                        <li id="second"></li>
                        <li id="third"></li>
                        <li id="fourth"></li>
                        <li id="fifth"></li>
                    </ol>
                </div>
                <div id="click-for-more">
                    <h2>Click on a player to see more info</h2>
                </div>
                <div id="selected-stats" style="display: none; flex-direction: column; opacity: 0;">
                    <h3>Selected Player Per Game Stats</h3>
                    <h3 id="name"></h3>
                    <h4 id="teamname"></h4>
                    <div style="display: flex; justify-content: space-around;">
                        <div style="display: flex; flex-direction: column;">
                            <text id="ppg"></text>
                            <text id="fg"></text>
                            <text id="three"></text>
                            <text id="turnovers"></text>
                        </div>
                        <div style="display: flex; flex-direction: column;">
                            <text id="reb"></text>
                            <text id="ast"></text>
                            <text id="stl"></text>
                            <text id="blk"></text>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <script>
            const load = async function() {
                let data = await d3.csv("modern_raptor.csv");
                let colorData = await d3.csv("nba-team-colors.csv");
                let stats = await d3.csv("nbaplayerstats20-21.csv");
                data = data.filter((d) => { return (d["season"]==="2021") });
                // data = data.filter((d) => { return (Number(d["mp"])>=1000) });
                data.forEach(d => {
                    let res = stats.filter(x => { return x["Player"].normalize('NFD').replace(/[\u0300-\u036f]/g, "")===d["player_name"]})
                    if (res[0]) {
                        let pos = res[0]['Pos']
                        d['position'] = pos
                        let age = res[0]['Age']
                        d['age'] = Number(age)
                        d['ppg'] = Number(res[0]['PTS'])
                        d['fg'] = (Number(res[0]['FG%'])*100).toFixed(1)
                        d['three'] = (Number(res[0]['3P%'])*100).toFixed(1)
                        d['reb'] = Number(res[0]['TRB'])
                        d['ast'] = Number(res[0]['AST'])
                        d['stl'] = Number(res[0]['STL'])
                        d['blk'] = Number(res[0]['BLK'])
                        d['to'] = Number(res[0]['TOV'])

                    }
                    d['mp'] = Number(d['mp'])
                    d['raptor_offense'] = Number(d['raptor_offense'])
                    d['raptor_defense'] = Number(d['raptor_defense'])


                });
                data = data.filter((d) => { return (d["position"]) });
                data = data.filter((d) => { return (d["age"]) });

                let topFive = data.sort((a, b) => b["raptor_total"] - a["raptor_total"]).slice(0, 5);

                console.log(data);

                var dataTeams = []
                data.map(function(d) {
                    if (!dataTeams.includes(d.team)){
                        dataTeams.push(d.team);
                    }
                })

                var teams = []
                var color1 = []
                var color2 = [];
                var teamNames = {};
                colorData.map(function(d) {
                    teams.push(d.Team);
                    color1.push(d.Color1);
                    color2.push(d.Color2);
                    teamNames[d.Team] = d.FullName

                })

                var primaryColors = d3.scaleOrdinal()
                    .domain(teams)
                    .range(color1);

                var secondaryColors = d3.scaleOrdinal()
                    .domain(teams)
                    .range(color2);

                var offExtent = d3.extent(data, d => d['raptor_offense']);
                var defExtent = d3.extent(data, d => d['raptor_defense']);
                const totalExtent = d3.extent(data, d => d['raptor_total'])

                const minutesExtent = d3.extent(data, d => d['mp'])
                const ageExtent = d3.extent(data, d => d['age'])

                const scatterplot = d3.select("#scatter");
                const scatterWidth = scatterplot.attr("width");
                const scatterHeight = scatterplot.attr("height");
                const scatterMargin = { top: 50, right: 50, bottom: 50, left: 50};
                const scatterAreaWidth = scatterWidth - scatterMargin.left - scatterMargin.right;
                const scatterAreaHeight = scatterHeight - scatterMargin.top - scatterMargin.bottom;

                
                scatterplot.append("rect")
                    .attr("fill", "lightblue")
                    .attr("x", scatterAreaWidth/2)
                    .attr("y", 0)
                    .attr("height", scatterAreaHeight/2)
                    .attr("width", scatterAreaWidth/2)
                    .attr("transform","translate("+scatterMargin.left+","+scatterMargin.top+")")
                    .attr("opacity", 0.7)
                scatterplot.append("rect")
                    .attr("fill", "pink")
                    .attr("x", 0)
                    .attr("y", scatterAreaHeight/2)
                    .attr("height", scatterAreaHeight/2 + 10)
                    .attr("width", scatterAreaWidth/2 + 10)
                    .attr("transform","translate("+(scatterMargin.left-10)+","+scatterMargin.top+")")
                    .attr("opacity", 0.7)

                let annotations = scatterplot.append("g").attr("id","annotations");
                const scatter = scatterplot.append("g")
                                // .attr("transform","translate("+scatterMargin.left+","+scatterMargin.top+")");
                

                let offScale = d3.scaleLinear().domain([-10, 10]).range([0, scatterAreaWidth]);
                let defScale = d3.scaleLinear().domain([10, -10]).range([0, scatterAreaHeight]);

                let leftAxis = d3.axisLeft(defScale)
                //    .tickFormat(d3.format("$.0s"));
                let leftGridlines = d3.axisLeft(defScale)
                                        .tickSize(-scatterAreaWidth-10)
                                        .tickFormat("")
                let bottomAxis = d3.axisBottom(offScale)
                                    // .tickFormat(d3.format("~f"));
                let bottomGridlines = d3.axisBottom(offScale)
                                        .tickSize(-scatterAreaHeight-10)
                                        .tickFormat("")
                
                let leftGridlinesG = annotations.append("g")
                    .attr("class", "y gridlines")
                    .attr("transform",`translate(${scatterMargin.left-10},${scatterMargin.top})`)
                    .call(leftGridlines);

                let leftAxisG = annotations.append("g")
                    .attr("class", "y axis")
                    .attr("transform",`translate(${scatterMargin.left-10},${scatterMargin.top})`)
                    .call(leftAxis)

                let bottomGridlinesG = annotations.append("g")
                    .attr("class", "x gridlines")
                    .attr("transform",`translate(${scatterMargin.left},${scatterAreaHeight+scatterMargin.top+10})`)
                    .call(bottomGridlines);
                let bottomAxisG =  annotations.append("g")
                    .attr("class", "x axis")
                    .attr("transform",`translate(${scatterMargin.left},${scatterAreaHeight+scatterMargin.top+10})`)
                    .call(bottomAxis);


                scatter.append("g")
                    .attr('transform', 'translate(' + scatterWidth/2 + ', ' + scatterHeight + ')')
                    .append('text')
                    .attr('text-anchor', 'middle')
                    .text("Offensive RAPTOR")
                scatter.append('g')
                    .attr('transform', 'translate(' + 15 + ', ' + scatterHeight/2 + ')')
                    .append('text')
                    .attr('text-anchor', 'middle')
                    .attr('transform', 'rotate(-90)')
                    .text("Defensive RAPTOR")


                //zero lines
                annotations.append("path")
                    .attr("d", `M${scatterMargin.left-10},${scatterMargin.top+(scatterAreaHeight/2)} h ${scatterAreaWidth+10}`)
                    .attr("stroke", "grey")
                        
                annotations.append("path")
                    .attr("d", `M${scatterMargin.left+(scatterAreaWidth/2)},${scatterMargin.top} v ${scatterAreaWidth+10} `)
                    .attr("stroke", "grey")

                function getNumericPixelVal(str){
                    return Number(String(str).substr(0, String(str).length-2))
                }

                

                
                let currentData = data;
                let currentMax = 10;
                let defaultMin = 10;
                let selectedPlayer = null;

                function plotCircles() {

                    var testDefExtent = d3.extent(currentData, d => d['raptor_defense']);
                    var testOffExtent = d3.extent(currentData, d => d['raptor_offense']);

                    let maxVal = Math.max(Math.abs(testDefExtent[0]), Math.abs(testDefExtent[1]), Math.abs(testOffExtent[0]), Math.abs(testOffExtent[1]))
                    if (maxVal > currentMax){
                        maxVal+=1
                        offScale = d3.scaleLinear().domain([-maxVal, maxVal]).range([0, scatterAreaWidth]);
                        defScale = d3.scaleLinear().domain([maxVal, -maxVal]).range([0, scatterAreaHeight]);

                        leftAxis = d3.axisLeft(defScale); //.tickFormat(d3.format('.0%'));
                        leftAxisG.transition().duration(350).call(leftAxis)

                        bottomAxis = d3.axisBottom(offScale);
                        bottomAxisG.transition().duration(350).call(bottomAxis)

                        leftGridlines = d3.axisLeft(defScale)
                                            .tickSize(-scatterAreaWidth-10)
                                            .tickFormat("")

                        leftGridlinesG.transition().duration(350).call(leftGridlines);

                        bottomGridlines = d3.axisBottom(offScale)
                                            .tickSize(-scatterAreaHeight-10)
                                            .tickFormat("")

                        bottomGridlinesG.transition().duration(350).call(bottomGridlines);
                        maxVal-=1

                    } else if (maxVal <= defaultMin){
                        offScale = d3.scaleLinear().domain([-10, 10]).range([0, scatterAreaWidth]);
                        defScale = d3.scaleLinear().domain([10, -10]).range([0, scatterAreaHeight]);


                        leftAxis = d3.axisLeft(defScale); //.tickFormat(d3.format('.0%'));
                        leftAxisG.transition().duration(350).call(leftAxis)

                        bottomAxis = d3.axisBottom(offScale);
                        bottomAxisG.transition().duration(350).call(bottomAxis)

                        leftGridlines = d3.axisLeft(defScale)
                                            .tickSize(-scatterAreaWidth-10)
                                            .tickFormat("")

                        leftGridlinesG.transition().duration(350).call(leftGridlines);

                        bottomGridlines = d3.axisBottom(offScale)
                                            .tickSize(-scatterAreaHeight-10)
                                            .tickFormat("")

                        bottomGridlinesG.transition().duration(350).call(bottomGridlines);
                    }

                    let circles = scatter.selectAll("circle.player")
                            .data(currentData)
                            .join('circle').attr("class", "player")
                            .attr("value", d => d['player_name'])
                            .attr("cx", d => offScale(d["raptor_offense"]))
                            .attr("cy", d => defScale(d["raptor_defense"]))
                            // .attr("r", 3.5)
                            .attr("r", function(d) {
                                if (topFive.includes(d)) {return 8}
                                else 	{ return 3.5 }
                            ;})
                            .attr("stroke", d=> secondaryColors(d['team']))
                            .attr("stroke-width", "1.5px")
                            .attr("fill", d=> primaryColors(d['team']))
                            .style("opacity", .8)
                            .attr("transform","translate("+scatterMargin.left+","+scatterMargin.top+")")
                            .style("filter", function(d) {
                                if (topFive.includes(d)) {return "drop-shadow(2px 2px 10px rgba(240, 240, 0, 1))"}
                                else 	{ return "none" }
                            ;})
                            .style("cursor", "pointer")
                            .on("mouseover", function(e, d){
                                d3.select(this)
                                    .raise()
                                    .transition().duration(250)
                                    .attr("r", 10)
                                    .attr("opacity", 0.8)

                                let tooltipWidth = 180;
                                let tooltipHeight = 70;
                                let tooltip = scatter.append("g")
                                    .attr("class","tooltip")
                                    .attr("opacity", .4)
                                    .raise()

                                let tooltipX = (-tooltipWidth/2) + getNumericPixelVal(offScale(d["raptor_offense"]))+scatterMargin.left
                                if ((tooltipX+(tooltipWidth)>=scatterAreaWidth+scatterMargin.left)){
                                    tooltipX = scatterAreaWidth+scatterMargin.left - (tooltipWidth)-2
                                } else if (tooltipX<=scatterMargin.left) {
                                    tooltipX = scatterMargin.left + 2
                                }

                                let tooltipY = getNumericPixelVal(defScale(d['raptor_defense']))+scatterMargin.top-tooltipHeight-15
                                if ((tooltipY<=0)){
                                    tooltipY = getNumericPixelVal(defScale(d['raptor_defense']))+scatterMargin.top+15
                                }
                                    
                                tooltip.append("rect")
                                    .attr("fill", "white")
                                    .attr("opacity", 1)
                                    .attr("x", tooltipX)
                                    .attr("y", tooltipY)
                                    .attr("rx", "5")
                                    .attr("ry", "5")
                                    .attr("width",tooltipWidth)
                                    .attr("height",tooltipHeight)
                                    .attr("stroke", "lightgrey")
                                    .attr("stroke-width", "1px")
                                let txt = tooltip.append("text")
                                    .text(d['player_name'] + " - " + d['team'])
                                    .attr("fill", "black")
                                    .attr("text-anchor","left")
                                    .attr("alignment-baseline","hanging")
                                    .attr("x", tooltipX+5)
                                    .attr("y", tooltipY + 5)
                                    .style("font-size", "13px");
                                let txt2 = tooltip.append("text")
                                    .text(`Total Raptor: ${Number(Number(d['raptor_offense'])+Number(d['raptor_defense'])).toFixed(2)}`)
                                    .attr("fill", "gray")
                                    .attr("text-anchor","left")
                                    .attr("alignment-baseline","hanging")
                                    .attr("x", tooltipX+5)
                                    .attr("y", tooltipY + 25)
                                    .style("font-size", "12px");

                                let txt3 = tooltip.append("text")
                                    .text(`Offensive Raptor: ${Number(d['raptor_offense']).toFixed(2)}`)
                                    .attr("fill", "gray")
                                    .attr("text-anchor","left")
                                    .attr("alignment-baseline","hanging")
                                    .attr("x",tooltipX+5)
                                    .attr("y", tooltipY + 40)
                                    .style("font-size", "12px");

                                let txt4 = tooltip.append("text")
                                    .text(`Defensive Raptor: ${Number(d['raptor_defense']).toFixed(2)}`)
                                    .attr("fill", "gray")
                                    .attr("text-anchor","left")
                                    .attr("alignment-baseline","hanging")
                                    .attr("x", tooltipX+5)
                                    .attr("y", tooltipY + 55)
                                    .style("font-size", "12px");

                                // let xPos = (d['coords'][0]+tooltipWidth+50);
                                // let yPos = (d['coords'][1]+tooltipHeight+5);

                                // tooltip.style("transform",`translate(${yPos}, ${xPos}) rotate(90deg)`);
                                d3.select(".tooltip")
                                    .raise()
                                    .transition().duration(300)
                                    .attr("opacity", 0.9)
                                    
                            })
                            .on("mouseout", function(e,d){
                                d3.select(this)
                                    .transition().duration(250)
                                    .attr("r", function(d) {
                                    if (topFive.includes(d)) {return 8}
                                    else 	{ 
                                        if (selectedPlayer){
                                            if (d['player_name'] == selectedPlayer._groups[0][0].__data__.player_name){
                                               return 7
                                            } else {
                                               return 3.5
                                            }
                                        } else {
                                            return 3.5
                                        }
                                    }
                                ;})
                                
                                d3.selectAll(".tooltip").remove()
                            })
                            .on("click", function(e,d){
                                if (selectedPlayer){
                                    let val = selectedPlayer._groups[0][0].getAttribute("value")
                                    let names = []
                                    topFive.forEach(d => {
                                        names.push(d['player_name'])
                                    });
                                    if (names.includes(val)){
                                        selectedPlayer.transition().duration(250).attr("r", 8)
                                    } else {
                                        selectedPlayer.transition().duration(250).attr("r", 3.5)
                                    }
                                }
                                selectedPlayer = d3.select(this) //.attr("r", 5)
                                d3.select("#click-for-more").style("opacity", 0).transition().delay(650).style("display", "none")
                                d3.select("#selected-stats").style("display", "flex").transition().delay(450).style("opacity", 1)

                                d3.select("h3#name").text(d['position'] + " - " + d['player_name'])
                                d3.select("h4#teamname").text(teamNames[d['team']]).style("background-color", primaryColors(d.team)).style("color", secondaryColors(d.team))
                                d3.select("text#ppg").text(d['ppg'] + " PPG")
                                d3.select("text#fg").text(d['fg'] + " FG%")
                                d3.select("text#three").text(d['three'] + " 3P%")
                                d3.select("text#reb").text(d['reb'] + " REB")
                                d3.select("text#ast").text(d['ast'] + " AST")
                                d3.select("text#stl").text(d['stl'] + " STL")
                                d3.select("text#blk").text(d['blk'] + " BLK")
                                d3.select("text#turnovers").text(d['to'] + " TO")

                            })
                }
                // plotCircles();

                d3.select("li#first").text(topFive[0]["player_name"])
                d3.select("li#second").text(topFive[1]["player_name"])
                d3.select("li#third").text(topFive[2]["player_name"])
                d3.select("li#fourth").text(topFive[3]["player_name"])
                d3.select("li#fifth").text(topFive[4]["player_name"])

                function capitalizeName(str){
                    // replace logic from Davon Dahon on Stack Overflow (https://stackoverflow.com/questions/40099093/capitalize-names-in-javascript)
                    return str.toLowerCase().replace(/\b\w/g, (c) => c.toUpperCase())
                }

                //player search
                var searchLabel = d3.select("div#filters-container").append("text").text("Player search:").style("font-weight", "bold");
                var searchDiv = d3.select("div#filters-container")
                                    .append("div")
                                    .attr("id", "searchContainer")
                                    .style("margin-bottom", "12px")

                var searchBar = searchDiv.append("input")
                                    .attr("id", "searchBar")
                                    .attr("type", "text")
                                    .style("margin-top", "6px")
                                    .on("input", function(e, d) {
                                        var searchName = d3.select(this).node().value
                                        if (searchName==""){
                                            filterPlot("player_name", "All");
                                        } else {
                                            filterPlot("player_name", capitalizeName(d3.select(this).node().value));
                                        }
                                    })
               
                let currRaptorType = "raptor_total"
                function raptorType() {
                    let values = ['raptor_total', 'raptor_offense', 'raptor_defense'];

                    // var label = d3.select("div#filters-container").append("text").text("RAPTOR Type");
                    var select = d3.select("div#top-five-title-container")
                                        .append("div")
                                        .append("select")
                                        .attr("class", "dropdownFilter")
                                        .attr("id", "raptorType")
                                        // .attr("data-field", field)
                                        .style("border", "1px solid black")
                                        .style("border-radius", "5px")
                                        // .style("margin-top", "6px")
                                        // .style("margin-bottom", "12px")
                                        .on("change", function(e, d) {
                                            filterPlot("type", d3.select(this).node().value);
                                            // filter(d3.select(this).attr("data-field"), d3.select(this).node().value);
                                        })
                    select.selectAll("raptorType")
                            .data(values)
                            .enter()
                                .append("option")
                                .attr("value", function (d) { return d; })
                                .text(function (d) { return d.substring(0,6).toUpperCase() + " " + d.charAt(7).toUpperCase() + d.substring(8); });

                }
                raptorType();


                function createDropdown(field) {
                    let values = [];
                    
                    currentData.forEach(d => {
                        if (!values.includes(d[field]) && d[field] !== "" && !d[field].includes("-")) {
                            values.push(d[field]);
                        }
                    })
                    values.sort();
                    if (field!="season_type"){
                        values.unshift("All");
                    } else {
                        values = ['RS', 'PO']
                    }
                    var label = d3.select("div#filters-container").append("text").text((field.substring(0,1).toUpperCase() + field.substring(1)).replace("_", " ")).style("font-weight", "bold");
                    var select = d3.select("div#filters-container")
                                        .append("div")
                                        .append("select")
                                        .attr("class", "dropdownFilter")
                                        .attr("id", `${field}Select`)
                                        .attr("data-field", field)
                                        .style("border", "1px solid black")
                                        .style("border-radius", "5px")
                                        .style("margin-top", "6px")
                                        .style("margin-bottom", "12px")
                                        .on("change", function(e, d){
                                            filterPlot(field, d3.select(this).node().value)
                                        })

                    select.selectAll(`${field}Select`)
                            .data(values)
                            .enter()
                                .append("option")
                                .attr("value", function (d) { return d; })
                                .text(function (d) { 
                                    if (field=="season_type"){
                                        if (d=="PO"){
                                            return 'Playoffs'
                                        } else if (d=="RS"){
                                            return 'Regular Season'
                                        } else {
                                            return d;
                                        } 
                                    } else {
                                        return d; 
                                    }
                                });
                }


                function createSlider(name, field, thisExtent){
                    if (field === "mp") {
                        var currMin = 1000
                        var textLabel = "+ minutes"
                    } else {
                        var currMin = 19
                        var textLabel = ""
                    }
                    
                    var nameSelect = d3.select("div#filters-container")
                                .append("div")
                                .attr("id", `${field}Div`)
                                .style("display", "flex")
                                .style("flex-direction", "column")
                                .style("justify-content", "space-between")
                                .style("marign-bottom", 0)

                    var label = d3.select(`div#${field}Div`).append("text").text(name).style("font-weight", "700");

                    var innerMinSelect = nameSelect
                                .append("div")
                                .attr("class", "sliderRow")
                                .style("display", "flex")
                                .style("flex-direction", "column")
                                .style("justify-content", "center")

                    //min slider
                    // var minLabel = innerMinSelect.append("p").text(name)

                    var minSlider = innerMinSelect.append("input")
                        .attr("type", "range")
                        .attr("min", thisExtent[0])
                        .attr('max', thisExtent[1])
                        .attr("id", "min"+field)
                        .attr("value", currMin)
                        .style("width", "50%")

                    minSlider
                        .on("input", function(e, d){
                            currMin = Number(this.value)
                            minValue.text(Number(currMin) + textLabel)
                            filterPlot(field, currMin)
                            
                        })
                    
                    if (field === "age") {
                        var minValue = innerMinSelect.append("p").attr("id", "ageLabel").text("Choose an age").style("margin-top", 0)
                        var resetButton = innerMinSelect.append("button").text("Reset Age").on("click", function(e,d){
                            filterPlot(field, "All")
                            document.getElementById("minage").value = 19;
                            minValue.text("Choose an age")
                        }).style("width", "50%");
                    } else {
                        var minValue = innerMinSelect.append("p").attr("id", "minLabel").text(Number(currMin) + textLabel).style("margin-top", 0)
                    }

                    // var innerMaxSelect = nameSelect
                    //             .append("div")
                    //             .attr("class", "sliderRow")
                    //             .style("display", "flex")
                    //             .style("flex-direction", "row")
                    //             .style("justify-content", "space-between")

                   
                    // nameSelect.append("hr")
                }

                createDropdown('season_type');
                createDropdown('position');
                createDropdown('team');

                createSlider("Min. Minutes Played", "mp", minutesExtent)
                createSlider("Age", "age", ageExtent)

                let currentFilters = {}
                // function filterRaptorType(val) {
                //     // delete currentFilters[field]
                //     // currentData = data

                //     // currentFilters[field] = val;
                //     topFive = data.sort((a, b) => b[val] - a[val]).slice(0, 5);
                //     d3.select("li#first").text(topFive[0]["player_name"])
                //     d3.select("li#second").text(topFive[1]["player_name"])
                //     d3.select("li#third").text(topFive[2]["player_name"])
                //     d3.select("li#fourth").text(topFive[3]["player_name"])
                //     d3.select("li#fifth").text(topFive[4]["player_name"])
                //     plotCircles();
                // }

                function filterPlot(field, val) {
                    if (field === "type") {
                        topFive = currentData.sort((a, b) => b[val] - a[val]).slice(0, 5);
                        currRaptorType = val
                    } else {
                        delete currentFilters[field]
                        currentData = data
                        if (val!=="All") {
                            currentFilters[field] = val;
                        }

                        //force minutes minimum down when switching to playoffs
                        if ((field=="season_type") && (val=="PO")){
                            if (currentFilters["mp"] > 750){
                                currentFilters["mp"] = 150
                                d3.select("#minmp").attr("value", 150)
                                d3.select("#minLabel").text("150+ minutes")
                            }
                        }

                        Object.keys(currentFilters).forEach(key => {
                            if (key==="mp"){
                                currentData = currentData.filter((d) => { return (Number(d[key]) >= currentFilters[key])})

                            } else if (key==="age") {
                                currentData = currentData.filter((d) => { return (Number(d[key]) === currentFilters[key])})
                            } else {
                                currentData = currentData.filter(d => { return d[key].includes(currentFilters[key]) });
                                // currentData = currentData.filter(d => { return d[field].includes(val) });
                            }
                        })
                        topFive = currentData.sort((a, b) => b[currRaptorType] - a[currRaptorType]).slice(0, 5);
                    }
                    
                    if (currentData.length >= 5) {
                        topFive = currentData.sort((a, b) => b[val] - a[val]).slice(0, 5);
                        d3.select("li#first").text(topFive[0]["player_name"] + ": " + Number(topFive[0][currRaptorType]).toFixed(2))
                        d3.select("li#second").text(topFive[1]["player_name"] + ": " + Number(topFive[1][currRaptorType]).toFixed(2))
                        d3.select("li#third").text(topFive[2]["player_name"] + ": " + Number(topFive[2][currRaptorType]).toFixed(2))
                        d3.select("li#fourth").text(topFive[3]["player_name"] + ": " + Number(topFive[3][currRaptorType]).toFixed(2))
                        d3.select("li#fifth").text(topFive[4]["player_name"] + ": " + Number(topFive[4][currRaptorType]).toFixed(2))
                    } else {
                        topFive = currentData.sort((a, b) => b[val] - a[val])
                        let numMap = {0: "first", 1: "second", 2: "third", 3: "fourth", 4: "fifth"}
                        for (let i=0; i < currentData.length; i++) {
                            d3.select(`li#${numMap[i]}`).text(topFive[i]["player_name"] + ": " + Number(topFive[i][currRaptorType]).toFixed(2))
                            delete numMap[i]
                        }
                        Object.keys(numMap).forEach(n => {
                            d3.select(`li#${numMap[n]}`).text("N/A")
                        })
                    }
                    plotCircles();
                }


                filterPlot("mp", 1000); //preset minutes filter to 1000 minimum
                filterPlot("season_type", 'RS'); //preset season type filter to regular season


                d3.select("#filters-container").append("button").text("Reset All Filters").on("click", function(e,d) {
                    filterPlot("player_name", "All");
                    // d3.select("#searchBar").setAttribute("value", "")
                    document.getElementById("searchBar").value = "";

                    filterPlot("season_type", "RS");
                    d3.select("#season_typeSelect").property("value", "RS")
                    
                    filterPlot("position", "All");
                    d3.select("#positionSelect").property("value", "All")

                    filterPlot("team", "All")
                    d3.select("#teamSelect").property("value", "All")

                    filterPlot("mp", 1000);
                    document.getElementById("minmp").value = 1000;
                    d3.select("#minLabel").text("1000+ minutes")

                    filterPlot("age", "All")
                    document.getElementById("minage").value = 19;
                    d3.select("#ageLabel").text("Choose an age")
                }).style("width", "70%").style("margin-top", "20px");

                let zoom = d3.zoom()
                    .on('zoom', handleZoom)
                    .scaleExtent([0.5, 6])
                    .translateExtent([[0, 0], [scatterWidth, scatterHeight]]);

                function handleZoom(e) {
                    d3.select('svg g')
                        .attr('transform', e.transform);
                }

                function initZoom() {
                    d3.select('svg')
                        .call(zoom);
                }
                // initZoom();

        }
            load();
        </script>
    </body>
</html>